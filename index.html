<script>
async function obtenerNoticias() {
    try {
        // siempre consume tu API directo
        const url = `https://jeanbhnz.app.n8n.cloud/webhook/noticia?api-key=242365f00faf4d9fb0fb3b2bee8d23d6&text=&language=es&number=10`;

        const response = await fetch(url, { cache: "no-store" });
        if (!response.ok) throw new Error('Error al obtener noticias');
        return await response.json();
    } catch (err) {
        console.error(err);
        return { news: [] };
    }
}

function mostrarNoticias(noticias) {
    const featuredArticleContainer = document.getElementById('featured-article');
    const articlesGridContainer = document.getElementById('articles-grid');

    let lista = Array.isArray(noticias) ? noticias : noticias.news;
    if (!lista || lista.length === 0) {
        featuredArticleContainer.innerHTML = '<p class="p-6 text-center text-gray-500">No se encontraron noticias.</p>';
        articlesGridContainer.innerHTML = '';
        return;
    }

    // tomar la primera noticia destacada
    const featuredArticle = lista[0];
    // si no trae fecha la API, usamos la fecha actual
    const fechaFeatured = featuredArticle.fecha 
        ? new Date(featuredArticle.fecha).toLocaleString('es-ES') 
        : new Date().toLocaleString('es-ES');

    featuredArticleContainer.innerHTML = `
        <div class="p-6 flex flex-col justify-center">
            ${featuredArticle.imagen ? `<img src="${featuredArticle.imagen}" alt="${featuredArticle.titulo}" class="w-full h-auto mb-4 rounded-lg object-cover">` : ''}
            <h3 class="text-3xl font-bold leading-tight mb-2">${featuredArticle.titulo || ''}</h3>
            <p class="text-gray-500 text-sm mb-2">ðŸ“… Publicado: ${fechaFeatured}</p>
            <p class="text-gray-700 text-lg mb-2">${featuredArticle.descripcion || ''}</p>
            <p class="text-gray-500 text-base mb-4">${featuredArticle.resumen || ''}</p>
            <a href="${featuredArticle.urlSitio || '#'}" target="_blank" class="self-start inline-block py-3 px-8 text-white font-bold rounded-full btn-primary hover:scale-105 transition-transform duration-300">Leer ArtÃ­culo Completo</a>
        </div>
    `;

    // otras noticias
    articlesGridContainer.innerHTML = '';
    lista.slice(1).forEach(article => {
        const fechaArticle = article.fecha 
            ? new Date(article.fecha).toLocaleString('es-ES') 
            : new Date().toLocaleString('es-ES');

        const articleCard = document.createElement('div');
        articleCard.className = 'card-bg rounded-card shadow-md overflow-hidden card-transition';
        articleCard.innerHTML = `
            ${article.imagen ? `<img src="${article.imagen}" alt="${article.titulo}" class="w-full h-48 object-cover">` : ''}
            <div class="p-5">
                <h4 class="text-xl font-bold mt-2 leading-tight">${article.titulo || ''}</h4>
                <p class="text-gray-500 text-xs mb-2">ðŸ“… Publicado: ${fechaArticle}</p>
                <p class="text-sm text-gray-600 mt-2 line-clamp-3">${article.descripcion || ''}</p>
                <p class="text-xs text-gray-500 mt-1">${article.resumen || ''}</p>
                <a href="${article.urlSitio || '#'}" target="_blank" class="mt-4 inline-block text-d81b60 font-semibold hover:underline">Leer mÃ¡s &rarr;</a>
            </div>
        `;
        articlesGridContainer.appendChild(articleCard);
    });
}

async function cargarNoticias() {
    const featuredArticleContainer = document.getElementById('featured-article');
    const articlesGridContainer = document.getElementById('articles-grid');
    featuredArticleContainer.innerHTML = '<div class="p-6 text-center"><div class="loader mx-auto"></div><p class="mt-4 text-gray-600">Cargando noticias...</p></div>';
    articlesGridContainer.innerHTML = '';
    try {
        const noticias = await obtenerNoticias();
        mostrarNoticias(noticias);
    } catch (err) {
        featuredArticleContainer.innerHTML = '<p class="p-6 text-center text-red-500">Error al cargar noticias.</p>';
    }
}

window.onload = cargarNoticias;
document.getElementById('reloadBtn').addEventListener('click', cargarNoticias);
</script>
